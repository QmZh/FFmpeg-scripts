#!/bin/bash

# #!/path/to/executable is a format

if [ $# -lt 1 ]; then # if number of parameters/arguments is less than 1
    WD=$(pwd) # set variable WD (literally working directory) as the output of the commamd pwd. The purpose is that when no arguments given just work on current directory
else
    WD=${1%/} # otherwise, set WD as parameter 1 treated as a string removing / at the tail. The purpose is to work on given directory, whether or not it has a trailing /. Plus, will relative paths like . .. or unspecified paths like * work? . and .. should work, not sure about * though.
fi

for d in "$WD"/*/ ; do # matching something ending with /, make sure to operate on folders
    d=${d%/} # order matters. First remove / at the end
    d=${d##*/} # order matters. Then remove longest substring ending with a / from left, this way only the folder name is kept
    echo "$d"
    VID=${d%%Source*} # VID is d removing Source* from back, max matching
    VID=${VID%%chunked*}
    VID=${VID%%audio*}
#    VID=${VID%2160p*}
    VID=${VID%%1440p*}
    VID=${VID%%1152p*}
    VID=${VID%%1080p*}
    VID=${VID%%936p*}
    VID=${VID%%900p*}
    VID=${VID%%720p*}
    VID=${VID%%480p*}
    VID=${VID%%360p*}
    VID=${VID%%160p*}
    VID=${VID%%144p*}
    VID=${VID%%high*}
    VID=${VID%%medium*}
    VID=${VID%%low*}
    VID=${VID%%mobile*}
    echo "$VID"
    if [[ $VID == $d ]]; then
        echo "Not matching pattern"
    elif test -f "$WD/$d/chats.json.gz"; then
        echo "exists"
    else
        TwitchDownloaderCLI chatdownload -E true -u $VID -o $WD/$d/chats.json --compression Gzip --chat-connections 16
	echo ""
	echo "ğŸ‘€ğŸ§ğŸ§¡ğŸ’›ğŸ’šğŸ’™ğŸ’œğŸ¤ğŸ–¤ğŸ¤ğŸ’˜ğŸ’ğŸ’–ğŸ’—ğŸ’“ğŸ’ğŸ’•ğŸ’ŒğŸ’ŸğŸŒ‘ğŸŒ’ğŸŒ“ğŸŒ”ğŸŒ•ğŸŒ–ğŸŒ—ğŸŒ˜ğŸˆğŸ“±â˜ï¸ğŸ“ğŸ“ŸğŸ“ ğŸ”ŒğŸ”‹ğŸª«ğŸ–²ï¸ğŸ’½ğŸ’¾ğŸ’¿ğŸ“€ğŸ–¥ï¸ğŸ’»âŒ¨ï¸ğŸ–¨ï¸ğŸ–±ï¸ğŸ•¯ï¸ğŸ’¡ğŸ”¦ğŸ®ğŸ§±ğŸªŸğŸªğŸšªğŸª‘ğŸ›ï¸ğŸ›‹ï¸ğŸš¿ğŸ›ğŸš½ğŸ§»ğŸ§·ğŸ§¹ğŸ§´ğŸ§½ğŸ§¼ğŸª¥ğŸª’â˜‚ï¸ğŸŒ‚ğŸ’ğŸ’ğŸ•¶ï¸ğŸ‘“ğŸ¥½âš—ï¸ğŸ§«ğŸ§ªğŸŒ¡ï¸ğŸ’‰ğŸ’ŠğŸ©ºğŸ”­ğŸ§¬ğŸ”¬ğŸ“¡ğŸ›°ï¸ğŸ§¯ğŸª“ğŸªœğŸª£ğŸªğŸ§²ğŸ§°ğŸ—œï¸ğŸ”©ğŸª›ğŸªšğŸ”§ğŸ”¨âš’ï¸ğŸ› ï¸â›ï¸âš™ï¸ğŸ”—â›“ï¸ğŸ“ğŸ–‡ï¸ğŸ“ğŸ“ğŸ–Œï¸ğŸ–ï¸ğŸ–Šï¸ğŸ–‹ï¸âœ’ï¸âœï¸ğŸ“ğŸ“–ğŸ“šğŸ“’ğŸ“”ğŸ“•ğŸ““ğŸ“—ğŸ“˜ğŸ“™ğŸ”–ğŸ—’ï¸ğŸ“„ğŸ“ƒğŸ“‹ğŸ“‘ğŸ“‚ğŸ“ğŸ—‚ï¸ğŸ—ƒï¸ğŸ—„ï¸ğŸ“ŠğŸ“ˆğŸ“‰ğŸ“‡ğŸªªğŸ“ŒğŸ“âœ‚ï¸ğŸ—‘ï¸ğŸ“°ğŸ—ï¸ğŸ·ï¸ğŸ“¦ğŸ“«ğŸ“ªğŸ“¬ğŸ“­ğŸ“®âœ‰ï¸ğŸ“§ğŸ“©ğŸ“¨ğŸ’ŒğŸ“¤ğŸ“¥ğŸ—³ï¸ğŸ•›ğŸ•§ğŸ•ğŸ•œğŸ•‘ğŸ•ğŸ•’ğŸ•ğŸ•“ğŸ•ŸğŸ•”ğŸ• ğŸ••ğŸ•¡ğŸ•–ğŸ•¢ğŸ•—ğŸ•£ğŸ•˜ğŸ•¤ğŸ•™ğŸ•¥ğŸ•šğŸ•¦â±ï¸âŒšğŸ•°ï¸âŒ›â³â²ï¸â°ğŸ“…ğŸ“†ğŸ—“ï¸ğŸª§ğŸ›ï¸ğŸ””ğŸ“¯ğŸ“¢ğŸ“£ğŸ”ğŸ”ğŸ”®ğŸ§¿ğŸª¬ğŸ“¿ğŸºâš±ï¸âš°ï¸ğŸª¦ğŸ’£ğŸª¤ğŸ“œâš”ï¸ğŸ—¡ï¸ğŸ›¡ï¸ğŸ—ï¸ğŸ”‘ğŸ”ğŸ”ğŸ”’ğŸ”“âœ´ï¸ğŸ”¶ğŸ”¸ğŸ”†ğŸ”…ğŸ“³ğŸ“²ğŸ”ˆğŸ”‰ğŸ”ŠğŸ¼ğŸµğŸ¶â˜¢ï¸â˜£ï¸âš ï¸ğŸš¸âšœï¸ğŸ”±ã€½ï¸ğŸ”°âœ³ï¸â‡ï¸â™»ï¸ââœ…âœ”ï¸â˜‘ï¸ğŸ†—ğŸ’ ğŸ”·ğŸ”¹ğŸŒâ•â–âœ–ï¸â—ğŸŸ°Â©ï¸Â®ï¸â„¢ï¸ğŸ”˜ğŸ”³â—¼ï¸â—¾â–ªï¸ğŸ”²â—»ï¸â—½â–«ï¸ğŸ‘ï¸â€ğŸ—¨ï¸"
    fi

done

